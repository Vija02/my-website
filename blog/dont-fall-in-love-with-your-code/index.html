<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Don&#x27;t fall in love without your code - Michael Salim | Senior Full Stack Freelancer and Startup Founder</title><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta name="description" content="Sometimes the best code is the code you delete. Don&#x27;t love your code and do what&#x27;s best for the codebase."/><meta name="author" content="Michael Salim"/><meta property="og:image" content="https://michaelsalim.co.uk/assets/blog/dont-fall-in-love-with-your-code/dont-fall-in-love-with-your-code.png"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@IamMichaelSalim"/><meta name="twitter:title" content="Don&#x27;t fall in love without your code - Michael Salim | Senior Full Stack Freelancer and Startup Founder"/><meta name="twitter:description" content="Sometimes the best code is the code you delete. Don&#x27;t love your code and do what&#x27;s best for the codebase."/><meta name="twitter:image" content="https://michaelsalim.co.uk/assets/blog/dont-fall-in-love-with-your-code/dont-fall-in-love-with-your-code.png"/><meta name="next-head-count" content="23"/><script defer="" data-domain="michaelsalim.co.uk" src="https://plausible.recalllab.com/js/script.js"></script><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/756ce6fb65f9d529.css" as="style"/><link rel="stylesheet" href="/_next/static/css/756ce6fb65f9d529.css" data-n-g=""/><link rel="preload" href="/_next/static/css/23d8b4760f974309.css" as="style"/><link rel="stylesheet" href="/_next/static/css/23d8b4760f974309.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-35c1f39d2b9d6474.js" defer=""></script><script src="/_next/static/chunks/framework-2bb1844fb22814b3.js" defer=""></script><script src="/_next/static/chunks/main-1d40e22e804e8dd0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-5f421f2b1dd19a1b.js" defer=""></script><script src="/_next/static/chunks/996-6e9225647c562f51.js" defer=""></script><script src="/_next/static/chunks/13-b51de0f50c54cf4c.js" defer=""></script><script src="/_next/static/chunks/57-ed8f46a022af046e.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-10a34371b0ac12a2.js" defer=""></script><script src="/_next/static/PAMaeYGHoosTgdPdoCx0F/_buildManifest.js" defer=""></script><script src="/_next/static/PAMaeYGHoosTgdPdoCx0F/_ssgManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Oswald:wght@700&display=swap">@font-face{font-family:'Oswald';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/oswald/v53/TK3_WkUHHAIjg75cFRf3bXL8LICs1xZogUI.woff) format('woff')}@font-face{font-family:'Oswald';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/oswald/v53/TK3_WkUHHAIjg75cFRf3bXL8LICs1xZosUtiYySUhiCXABTV.woff) format('woff');unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Oswald';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/oswald/v53/TK3_WkUHHAIjg75cFRf3bXL8LICs1xZosUJiYySUhiCXABTV.woff) format('woff');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Oswald';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/oswald/v53/TK3_WkUHHAIjg75cFRf3bXL8LICs1xZosUliYySUhiCXABTV.woff) format('woff');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Oswald';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/oswald/v53/TK3_WkUHHAIjg75cFRf3bXL8LICs1xZosUhiYySUhiCXABTV.woff) format('woff');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Oswald';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/oswald/v53/TK3_WkUHHAIjg75cFRf3bXL8LICs1xZosUZiYySUhiCXAA.woff) format('woff');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style><style data-href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;400;500;600;700&display=swap">@font-face{font-family:'Inter';font-style:normal;font-weight:100;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcCO3FwrK3iLTeHuS_nVMrMxCp50SjIw2boKoduKmMEVuLyeMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:200;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcCO3FwrK3iLTeHuS_nVMrMxCp50SjIw2boKoduKmMEVuDyfMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcCO3FwrK3iLTeHuS_nVMrMxCp50SjIw2boKoduKmMEVuLyfMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcCO3FwrK3iLTeHuS_nVMrMxCp50SjIw2boKoduKmMEVuI6fMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcCO3FwrK3iLTeHuS_nVMrMxCp50SjIw2boKoduKmMEVuGKYMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcCO3FwrK3iLTeHuS_nVMrMxCp50SjIw2boKoduKmMEVuFuYMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:100;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:100;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:100;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:100;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:100;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:100;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:100;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:200;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:200;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:200;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:200;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:200;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:200;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:200;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><span style="display:hidden;font-family:Oswald"></span><span style="display:hidden;font-family:Inter"></span><div id="__next"><div class="StandardHeader_container___l2zb"><a href="/"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 640 640" width="640" height="640"><defs><path d="M613.23 0C628.01 0 640 11.99 640 26.77v586.75c0 14.79-11.99 26.78-26.77 26.78H26.77C11.99 640.3 0 628.31 0 613.52V26.77C0 11.99 11.99 0 26.77 0h586.46z" id="a"></path><path d="M93.84 552.22l15.55-233.81-11.6-182.26 52.57 79.34-16.13 227.1 11.29 109.63H93.84z" id="b"></path><path d="M98.1 113.9l39.41-28.58 106.35 180.79 67.37 166.31-44.09-7.17-86.48-197.04L98.1 113.9z" id="c"></path><path d="M314.52 477.17l34.12-7.81 37.15-77.98 101.96-159.87 52.92-93.74-26.89-33.57-95.79 176.45-49.61 76.69-48.82 88.3-48.79-7.73 43.75 39.26z" id="d"></path><path d="M532.07 272.26v222.85l18 48.86h-52.72l9.68-157.91-9.68-136.52 47.63-90.01-12.91 112.73z" id="e"></path></defs><use xlink:href="#a" fill="#e60916"></use><use xlink:href="#b" fill="#fff"></use><use xlink:href="#b" fill-opacity="0" stroke="#000" stroke-width="0"></use><use xlink:href="#c" fill="#fff"></use><use xlink:href="#c" fill-opacity="0" stroke="#000" stroke-width="0"></use><g><use xlink:href="#d" fill="#fff"></use><use xlink:href="#d" fill-opacity="0" stroke="#000" stroke-width="0"></use></g><g><use xlink:href="#e" fill="#fff"></use><use xlink:href="#e" fill-opacity="0" stroke="#000" stroke-width="0"></use></g></svg></a></div><div class="Blog_container__YQ7Uw"><h1>Don&#x27;t fall in love without your code</h1><p>December 7, 2024</p><div class="Blog_author__BqKeu"><img src="https://avatars.githubusercontent.com/u/5815761?s=48&amp;v=4"/><div><span>Michael Salim</span><a href="https://twitter.com/IAmMichaelSalim" target="_blank" rel="noopener noreferrer" class="Blog_handle__Ec1U6">@IAmMichaelSalim</a></div></div><div class="Blog_content__mG5Ae"><p>I just deleted hundreds of lines of code I wrote yesterday and replaced them with 32 lines of new code. This was for a feature for <a target="_blank" rel="noopener" href="https://github.com/Vija02/TheOpenPresenter">TheOpenPresenter</a>, used to indicate if an audio is playing.</p>
<p>Every so often, I‚Äôd work on a functionality that seems quite straightforward to implement. In this case, I just needed to show this icon when audio is playing.</p>
<p><img src="/assets/blog/dont-fall-in-love-with-your-code/sample.png" alt="sample"/></p>
<p>Simple enough. Each of these is a scene containing multiple plugins. Each plugin has its own property like <code>isPlaying</code> . We can merge the values between the plugins, and if the flag is true, we can show the icon.</p>
<h2>Architecting a solution</h2>
<p>The main issue is how to access this data. See, we could access the data directly. But each plugin can have its own schema. While some plugins may have a simple <strong>isPlaying</strong> property, some others might need something more complicated to represent its playing status.</p>
<p>Simple, why not allow the plugin to register a callback/function that returns the state?</p>
<p>This is the same pattern that TheOpenPresenter uses for many of its plugins. And while we‚Äôre at it, we can abstract it into a <strong>SceneState</strong> object. So if we ever need any other state, we can add it here. Here‚Äôs how it might look like for the plugin:</p>
<pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic">// The pattern we use for plugins</span></span>
<span class="line"><span style="color:#E5C07B">serverPluginApi</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">onPluginDataCreated</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">pluginName</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">onPluginDataCreated</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">serverPluginApi</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">onPluginDataLoaded</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">pluginName</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">onPluginDataLoaded</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">serverPluginApi</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">registerRemoteViewWebComponent</span><span style="color:#ABB2BF">(</span></span>
<span class="line"><span style="color:#E06C75">  pluginName</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75">  remoteWebComponentTag</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">// Example of how the new API might look like</span></span>
<span class="line"><span style="color:#E5C07B">serverPluginApi</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">registerSceneState</span><span style="color:#ABB2BF">(</span></span>
<span class="line"><span style="color:#E06C75">  pluginName</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">  (</span><span style="color:#E06C75;font-style:italic">_</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75;font-style:italic">rendererData</span><span style="color:#ABB2BF">) </span><span style="color:#C678DD">=&gt;</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">    return</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E06C75">      audioIsPlaying</span><span style="color:#ABB2BF">: </span><span style="color:#56B6C2">!!</span><span style="color:#E5C07B">rendererData</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">find</span><span style="color:#ABB2BF">((</span><span style="color:#E06C75;font-style:italic">x</span><span style="color:#ABB2BF">) </span><span style="color:#C678DD">=&gt;</span><span style="color:#E5C07B"> x</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">isPlaying</span><span style="color:#ABB2BF">),</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#ABB2BF">);</span></span></code></pre>
<h2>Server handling</h2>
<p>Notice that the code above is handled on the server. This is because TheOpenPresenter consists of 3 separate components:</p>
<ol>
<li>The Remote - where this audio indication is shown</li>
<li>The Renderer - plays the audio</li>
<li>The Server - connects the two</li>
</ol>
<p>Ideally, we should handle this in the frontend (remote) so that we don‚Äôt add extra load to the server. However, registering this function can be messy. Our frontend uses a micro-frontend architecture loaded with Web components.</p>
<p>The red area below is a React shell. The green area is loaded through web components and is managed by each plugin.</p>
<p><img src="/assets/blog/dont-fall-in-love-with-your-code/shell.png" alt="Shell"/></p>
<p>Notice that the audio icon is located on the left side of the shell. How do we provide the function that we need to the shell? We could include a JS function in the web component bundle but that sounds like a mess in the long term.</p>
<p>Handling this on the server seems like the proper way to do this.</p>
<h2>Plumbing the data through</h2>
<p>With that decided, it‚Äôs time for implementation. There are a few things to do:</p>
<ol>
<li>Create the plugin API</li>
<li>Provide this data to the frontend</li>
<li>Consume and update the UI</li>
</ol>
<h3>Implementing</h3>
<p>I won‚Äôt bore you with the details so here‚Äôs an overview. The API was not quite straightforward since our data can be quite confusing. In short: A scene can have multiple plugins. And there can be multiple renderers, each viewing a scene in a different way. So a plugin could have multiple renderers showing it in different ways. But with a bit of data manipulation, problem solved.</p>
<p><strong>Consuming and updating the UI</strong></p>
<p>Consuming the value was straightforward. I contemplated using Yjs‚Äôs awareness protocol to provide the data since it‚Äôs real-time and the framework is already in place. This is how the state is stored. However, including this data from the server is its own problem. So I decided to use GraphQL instead - the protocol we‚Äôre using for everything else in the platform.</p>
<p>So all we need to do is call the endpoint, listen to it using GraphQL‚Äôs subscription, and show the icon as needed. Done.</p>
<p><strong>Providing this data to the frontend</strong></p>
<p>Thankfully, we use <a target="_blank" rel="noopener" href="https://postgraphile.org/">Postgraphile</a> which makes extending the GraphQL schema quite straightforward. We can also make it a subscription simply by adding  <code>@pgSubscription</code> to the GraphQL schema. It‚Äôll then watch a topic and update the value whenever we call <code>pg_notify</code> on that topic. For example:</p>
<pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">await</span><span style="color:#E5C07B"> pgPool</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">query</span><span style="color:#ABB2BF">(</span></span>
<span class="line"><span style="color:#98C379">  `select pg_notify(&#x27;graphql:sceneState:</span><span style="color:#C678DD">${</span><span style="color:#E06C75">id</span><span style="color:#C678DD">}</span><span style="color:#98C379">&#x27;,&#x27;{}&#x27;);`</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">  [],</span></span>
<span class="line"><span style="color:#ABB2BF">);</span></span></code></pre>
<p>Manipulating the data was annoying but just a bit of patience and it‚Äôs done!</p>
<p>The last piece of the puzzle is calling <code>pg_notify</code> when we need to.</p>
<p>For this, we can add a listener to the state (Yjs) and call the notify whenever anything changes:</p>
<pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B">state</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">observeDeep</span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">async</span><span style="color:#ABB2BF"> () </span><span style="color:#C678DD">=&gt;</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">  // Call pg_notify here</span></span>
<span class="line"><span style="color:#ABB2BF">});</span></span></code></pre>
<p>The only thing left to do is performance improvements. Right now, the function is called for every small change, it‚Äôs also updated to the frontend. We can calculate the resulting state and compare if anything changes before pushing the update.</p>
<h2>Better solution</h2>
<p>Now this solution certainly works. But I hated that we were listening to every single change. It‚Äôs unnecessary and I‚Äôm not sure how the performance will scale. Is there any better solution?</p>
<p>So I stepped back for a second and an idea came: <strong>How about we go to the basics and use the data from Yjs?</strong></p>
<p>The problem was that each plugin may use different ways to indicate play status. So we needed a way to know how to calculate the resulting state ourselves. But rather than letting the user pass a function, <strong>why not reserve a property that they can use to indicate this?</strong></p>
<p>Rather than passing a function to calculate the state, each plugin could set the reserved state directly alongside their existing data with properties like <code>__audioIsPlaying</code> . They could use this value directly, or they could keep it in sync with their existing properties like so:</p>
<pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">const</span><span style="color:#61AFEF"> onRendererDataLoaded</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> (</span></span>
<span class="line"><span style="color:#E06C75;font-style:italic">  rendererData</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">) </span><span style="color:#C678DD">=&gt;</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#61AFEF">  watchYjs</span><span style="color:#ABB2BF">(</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">	  // Watch the isPlaying property</span></span>
<span class="line"><span style="color:#ABB2BF">    (</span><span style="color:#E06C75;font-style:italic">x</span><span style="color:#ABB2BF">) </span><span style="color:#C678DD">=&gt;</span><span style="color:#E5C07B"> x</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">isPlaying</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">    () </span><span style="color:#C678DD">=&gt;</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">	    // And if it changes, sync the __audioIsPlaying property</span></span>
<span class="line"><span style="color:#E5C07B">      rendererData</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">set</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">&quot;__audioIsPlaying&quot;</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">rendererData</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">get</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">&quot;isPlaying&quot;</span><span style="color:#ABB2BF">));</span></span>
<span class="line"><span style="color:#ABB2BF">    },</span></span>
<span class="line"><span style="color:#ABB2BF">  );</span></span>
<span class="line"><span style="color:#ABB2BF">};</span></span></code></pre>
<h2>Deleting old code</h2>
<p>The new method is brilliant. No extra listener, no extra API, just a simple reserved property.</p>
<p>The cost? Well, I already wrote 95% of the first implementation ü´£</p>
<p><em><strong>‚ÄúIt‚Äôll be such a shame to delete this when I‚Äôve worked on it for so long. Everything else is perfect other than this one thing!‚Äù</strong> - My mind</em></p>
<p>This is not my first time. Not second or third either. This time it was just a few hours of work. The longer it takes to implement, the harder it is to let go. But if we should not get attached to servers, we shouldn‚Äôt be attached to the code we write either.</p>
<p>It‚Äôs obvious that the second implementation is better. It‚Äôs faster, less moving parts, less API surface, and less code to maintain. The <a target="_blank" rel="noopener" href="https://github.com/Vija02/TheOpenPresenter/commit/485fd2ff4d4dc1fdb1e010da2fe71d9bdc7ca45f">first implementation</a> added 289 new lines while the <a target="_blank" rel="noopener" href="https://github.com/Vija02/TheOpenPresenter/commit/8c72633158debf9dcb54e826e61cb69b31a304e7">second implementation</a> only added 32 new lines.</p>
<p><strong>What‚Äôs the lesson to learn then?</strong></p>
<p>Well, maybe find the simplest solution first. But sometimes we don‚Äôt reach the best solution just by thinking about it. If that‚Äôs the case, <strong>don‚Äôt love your code and don‚Äôt be afraid to throw it away</strong>. And maybe write a blog post so that you get something out of it!</p>
<hr/>
<p>If you&#x27;re read this far, you might want to try <a target="_blank" rel="noopener" href="https://theopenpresenter.com/">TheOpenPresenter</a>! It&#x27;s an open-source presentation system that lets you control any of your screens remotely.</p>
<p>Show slideshows, play videos, use as dashboards and many more. The software is still very early in development as you can tell from this post but it&#x27;s stable enough to use regularly. I personally use it for my meetups every week.</p>
<p>Any questions, do ask. Or feel free to report issues in the <a target="_blank" rel="noopener" href="https://github.com/Vija02/TheOpenPresenter">Github repo</a>.</p></div><div class="Blog_socials__cizGC"><span>SHARE THIS ARTICLE:</span><button aria-label="linkedin" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><rect width="64" height="64" rx="0" ry="0" fill="#007fb1" style="fill:transparent"></rect><path d="M20.4,44h5.4V26.6h-5.4V44z M23.1,18c-1.7,0-3.1,1.4-3.1,3.1c0,1.7,1.4,3.1,3.1,3.1 c1.7,0,3.1-1.4,3.1-3.1C26.2,19.4,24.8,18,23.1,18z M39.5,26.2c-2.6,0-4.4,1.4-5.1,2.8h-0.1v-2.4h-5.2V44h5.4v-8.6 c0-2.3,0.4-4.5,3.2-4.5c2.8,0,2.8,2.6,2.8,4.6V44H46v-9.5C46,29.8,45,26.2,39.5,26.2z" fill="white"></path></svg></button><button aria-label="twitter" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><rect width="64" height="64" rx="0" ry="0" fill="#00aced" style="fill:transparent"></rect><path d="M48,22.1c-1.2,0.5-2.4,0.9-3.8,1c1.4-0.8,2.4-2.1,2.9-3.6c-1.3,0.8-2.7,1.3-4.2,1.6 C41.7,19.8,40,19,38.2,19c-3.6,0-6.6,2.9-6.6,6.6c0,0.5,0.1,1,0.2,1.5c-5.5-0.3-10.3-2.9-13.5-6.9c-0.6,1-0.9,2.1-0.9,3.3 c0,2.3,1.2,4.3,2.9,5.5c-1.1,0-2.1-0.3-3-0.8c0,0,0,0.1,0,0.1c0,3.2,2.3,5.8,5.3,6.4c-0.6,0.1-1.1,0.2-1.7,0.2c-0.4,0-0.8,0-1.2-0.1 c0.8,2.6,3.3,4.5,6.1,4.6c-2.2,1.8-5.1,2.8-8.2,2.8c-0.5,0-1.1,0-1.6-0.1c2.9,1.9,6.4,2.9,10.1,2.9c12.1,0,18.7-10,18.7-18.7 c0-0.3,0-0.6,0-0.8C46,24.5,47.1,23.4,48,22.1z" fill="white"></path></svg></button></div></div><div class="HireMe_container__NSfeb"><img src="/assets/img/headshot.jpg" alt="Head shot"/><div><p class="HireMe_hireme__FIrPX">Hire Me!</p><p class="HireMe_subheading__yN8cM">Available for a remote contract work</p><p class="HireMe_content____As7">Michael is a full-stack developer and the founder of<!-- --> <a href="https://recalllab.com">Recall</a> and<!-- --> <a href="https://dbschemalibrary.com">DbSchemaLibrary</a>.</p><p class="HireMe_content____As7">He primarily works with React codebases but is proficient in all aspects of the stack, including back-end development and system operations.</p><div class="HireMe_cta__u_s6m"><a href="mailto:hi@michaelsalim.co.uk"><button class="HireMe_primaryButton__D6ghz">‚úâÔ∏è Send me an email</button></a><a href="https://calendly.com/michael-salim/30min" target="_blank" rel="noopener noreferrer"><button>üìû Book a call</button></a><div class="HireMe_socials__z5dKA"><a href="https://www.linkedin.com/in/michael-salim/" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="2500" height="2389" viewBox="0 5 1036 990"><path fill="inherit" d="M0 120c0-33.334 11.667-60.834 35-82.5C58.333 15.833 88.667 5 126 5c36.667 0 66.333 10.666 89 32 23.333 22 35 50.666 35 86 0 32-11.333 58.666-34 80-23.333 22-54 33-92 33h-1c-36.667 0-66.333-11-89-33S0 153.333 0 120zm13 875V327h222v668H13zm345 0h222V622c0-23.334 2.667-41.334 8-54 9.333-22.667 23.5-41.834 42.5-57.5 19-15.667 42.833-23.5 71.5-23.5 74.667 0 112 50.333 112 151v357h222V612c0-98.667-23.333-173.5-70-224.5S857.667 311 781 311c-86 0-153 37-201 111v2h-1l1-2v-95H358c1.333 21.333 2 87.666 2 199 0 111.333-.667 267.666-2 469z"></path></svg></a><a href="https://github.com/vija02/" target="_blank" rel="noopener noreferrer"><svg version="1.2" baseProfile="tiny" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2350 2314.8"><path fill="inherit" d="M1175 0C525.8 0 0 525.8 0 1175c0 552.2 378.9 1010.5 890.1 1139.7-5.9-14.7-8.8-35.3-8.8-55.8v-199.8H734.4c-79.3 0-152.8-35.2-185.1-99.9-38.2-70.5-44.1-179.2-141-246.8-29.4-23.5-5.9-47 26.4-44.1 61.7 17.6 111.6 58.8 158.6 120.4 47 61.7 67.6 76.4 155.7 76.4 41.1 0 105.7-2.9 164.5-11.8 32.3-82.3 88.1-155.7 155.7-190.9-393.6-47-581.6-240.9-581.6-505.3 0-114.6 49.9-223.3 132.2-317.3-26.4-91.1-61.7-279.1 11.8-352.5 176.3 0 282 114.6 308.4 143.9 88.1-29.4 185.1-47 284.9-47 102.8 0 196.8 17.6 284.9 47 26.4-29.4 132.2-143.9 308.4-143.9 70.5 70.5 38.2 261.4 8.8 352.5 82.3 91.1 129.3 202.7 129.3 317.3 0 264.4-185.1 458.3-575.7 499.4 108.7 55.8 185.1 214.4 185.1 331.9V2256c0 8.8-2.9 17.6-2.9 26.4C2021 2123.8 2350 1689.1 2350 1175 2350 525.8 1824.2 0 1175 0z"></path></svg></a></div></div></div></div><div class="Footer_heightPad__2CY5R"></div><div class="Footer_absoluteContainer__uK_pp"><div class="Footer_container__i_JCi"><a href="/">Home</a><a href="/about-me/">About</a><a href="/blog/">Blog</a><a href="/dev-notes/">Dev Notes</a><a href="/contact-me/">Contact</a><div class="Footer_socialMedia__gIaa4"><a href="https://twitter.com/IamMichaelSalim/" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="inherit" d="M24 4.557a9.83 9.83 0 0 1-2.828.775 4.932 4.932 0 0 0 2.165-2.724 9.864 9.864 0 0 1-3.127 1.195 4.916 4.916 0 0 0-3.594-1.555c-3.179 0-5.515 2.966-4.797 6.045A13.978 13.978 0 0 1 1.671 3.149a4.93 4.93 0 0 0 1.523 6.574 4.903 4.903 0 0 1-2.229-.616c-.054 2.281 1.581 4.415 3.949 4.89a4.935 4.935 0 0 1-2.224.084 4.928 4.928 0 0 0 4.6 3.419A9.9 9.9 0 0 1 0 19.54a13.94 13.94 0 0 0 7.548 2.212c9.142 0 14.307-7.721 13.995-14.646A10.025 10.025 0 0 0 24 4.557z"></path></svg></a><a href="https://www.linkedin.com/in/michael-salim/" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="2500" height="2389" viewBox="0 5 1036 990"><path fill="inherit" d="M0 120c0-33.334 11.667-60.834 35-82.5C58.333 15.833 88.667 5 126 5c36.667 0 66.333 10.666 89 32 23.333 22 35 50.666 35 86 0 32-11.333 58.666-34 80-23.333 22-54 33-92 33h-1c-36.667 0-66.333-11-89-33S0 153.333 0 120zm13 875V327h222v668H13zm345 0h222V622c0-23.334 2.667-41.334 8-54 9.333-22.667 23.5-41.834 42.5-57.5 19-15.667 42.833-23.5 71.5-23.5 74.667 0 112 50.333 112 151v357h222V612c0-98.667-23.333-173.5-70-224.5S857.667 311 781 311c-86 0-153 37-201 111v2h-1l1-2v-95H358c1.333 21.333 2 87.666 2 199 0 111.333-.667 267.666-2 469z"></path></svg></a><a href="https://github.com/vija02/" target="_blank" rel="noopener noreferrer"><svg version="1.2" baseProfile="tiny" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2350 2314.8"><path fill="inherit" d="M1175 0C525.8 0 0 525.8 0 1175c0 552.2 378.9 1010.5 890.1 1139.7-5.9-14.7-8.8-35.3-8.8-55.8v-199.8H734.4c-79.3 0-152.8-35.2-185.1-99.9-38.2-70.5-44.1-179.2-141-246.8-29.4-23.5-5.9-47 26.4-44.1 61.7 17.6 111.6 58.8 158.6 120.4 47 61.7 67.6 76.4 155.7 76.4 41.1 0 105.7-2.9 164.5-11.8 32.3-82.3 88.1-155.7 155.7-190.9-393.6-47-581.6-240.9-581.6-505.3 0-114.6 49.9-223.3 132.2-317.3-26.4-91.1-61.7-279.1 11.8-352.5 176.3 0 282 114.6 308.4 143.9 88.1-29.4 185.1-47 284.9-47 102.8 0 196.8 17.6 284.9 47 26.4-29.4 132.2-143.9 308.4-143.9 70.5 70.5 38.2 261.4 8.8 352.5 82.3 91.1 129.3 202.7 129.3 317.3 0 264.4-185.1 458.3-575.7 499.4 108.7 55.8 185.1 214.4 185.1 331.9V2256c0 8.8-2.9 17.6-2.9 26.4C2021 2123.8 2350 1689.1 2350 1175 2350 525.8 1824.2 0 1175 0z"></path></svg></a></div><div class="Footer_bottom__dmDDW"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 640 640" width="640" height="640"><defs><path d="M613.23 0C628.01 0 640 11.99 640 26.77v586.75c0 14.79-11.99 26.78-26.77 26.78H26.77C11.99 640.3 0 628.31 0 613.52V26.77C0 11.99 11.99 0 26.77 0h586.46z" id="a"></path><path d="M93.84 552.22l15.55-233.81-11.6-182.26 52.57 79.34-16.13 227.1 11.29 109.63H93.84z" id="b"></path><path d="M98.1 113.9l39.41-28.58 106.35 180.79 67.37 166.31-44.09-7.17-86.48-197.04L98.1 113.9z" id="c"></path><path d="M314.52 477.17l34.12-7.81 37.15-77.98 101.96-159.87 52.92-93.74-26.89-33.57-95.79 176.45-49.61 76.69-48.82 88.3-48.79-7.73 43.75 39.26z" id="d"></path><path d="M532.07 272.26v222.85l18 48.86h-52.72l9.68-157.91-9.68-136.52 47.63-90.01-12.91 112.73z" id="e"></path></defs><use xlink:href="#a" fill="#e60916"></use><use xlink:href="#b" fill="#fff"></use><use xlink:href="#b" fill-opacity="0" stroke="#000" stroke-width="0"></use><use xlink:href="#c" fill="#fff"></use><use xlink:href="#c" fill-opacity="0" stroke="#000" stroke-width="0"></use><g><use xlink:href="#d" fill="#fff"></use><use xlink:href="#d" fill-opacity="0" stroke="#000" stroke-width="0"></use></g><g><use xlink:href="#e" fill="#fff"></use><use xlink:href="#e" fill-opacity="0" stroke="#000" stroke-width="0"></use></g></svg><span class="Footer_verse__hquw8">‚Äî John 3:16 ‚Äî</span><span>¬© <!-- -->2024<!-- --> Michael Salim</span></div></div></div><div class="Toastify"></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"title":"Don't fall in love without your code","description":"Sometimes the best code is the code you delete. Don't love your code and do what's best for the codebase.","image":"/assets/blog/dont-fall-in-love-with-your-code/dont-fall-in-love-with-your-code.png","createdAt":"Sat Dec 07 2024 00:00:00 GMT+0000 (Greenwich Mean Time)","source":{"compiledSource":"\"use strict\";\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = {\n    a: \"a\",\n    code: \"code\",\n    em: \"em\",\n    h2: \"h2\",\n    h3: \"h3\",\n    hr: \"hr\",\n    img: \"img\",\n    li: \"li\",\n    ol: \"ol\",\n    p: \"p\",\n    pre: \"pre\",\n    span: \"span\",\n    strong: \"strong\",\n    ..._provideComponents(),\n    ...props.components\n  };\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.p, {\n      children: [\"I just deleted hundreds of lines of code I wrote yesterday and replaced them with 32 lines of new code. This was for a feature for \", _jsx(_components.a, {\n        href: \"https://github.com/Vija02/TheOpenPresenter\",\n        children: \"TheOpenPresenter\"\n      }), \", used to indicate if an audio is playing.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Every so often, I‚Äôd work on a functionality that seems quite straightforward to implement. In this case, I just needed to show this icon when audio is playing.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"/assets/blog/dont-fall-in-love-with-your-code/sample.png\",\n        alt: \"sample\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Simple enough. Each of these is a scene containing multiple plugins. Each plugin has its own property like \", _jsx(_components.code, {\n        children: \"isPlaying\"\n      }), \" . We can merge the values between the plugins, and if the flag is true, we can show the icon.\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Architecting a solution\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The main issue is how to access this data. See, we could access the data directly. But each plugin can have its own schema. While some plugins may have a simple \", _jsx(_components.strong, {\n        children: \"isPlaying\"\n      }), \" property, some others might need something more complicated to represent its playing status.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Simple, why not allow the plugin to register a callback/function that returns the state?\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"This is the same pattern that TheOpenPresenter uses for many of its plugins. And while we‚Äôre at it, we can abstract it into a \", _jsx(_components.strong, {\n        children: \"SceneState\"\n      }), \" object. So if we ever need any other state, we can add it here. Here‚Äôs how it might look like for the plugin:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"shiki one-dark-pro\",\n      style: {\n        backgroundColor: \"#282c34\",\n        color: \"#abb2bf\"\n      },\n      tabIndex: \"0\",\n      children: _jsxs(_components.code, {\n        children: [_jsx(_components.span, {\n          className: \"line\",\n          children: _jsx(_components.span, {\n            style: {\n              color: \"#7F848E\",\n              fontStyle: \"italic\"\n            },\n            children: \"// The pattern we use for plugins\"\n          })\n        }), \"\\n\", _jsxs(_components.span, {\n          className: \"line\",\n          children: [_jsx(_components.span, {\n            style: {\n              color: \"#E5C07B\"\n            },\n            children: \"serverPluginApi\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \".\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#61AFEF\"\n            },\n            children: \"onPluginDataCreated\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \"(\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#E06C75\"\n            },\n            children: \"pluginName\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \", \"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#E06C75\"\n            },\n            children: \"onPluginDataCreated\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \");\"\n          })]\n        }), \"\\n\", _jsxs(_components.span, {\n          className: \"line\",\n          children: [_jsx(_components.span, {\n            style: {\n              color: \"#E5C07B\"\n            },\n            children: \"serverPluginApi\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \".\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#61AFEF\"\n            },\n            children: \"onPluginDataLoaded\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \"(\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#E06C75\"\n            },\n            children: \"pluginName\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \", \"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#E06C75\"\n            },\n            children: \"onPluginDataLoaded\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \");\"\n          })]\n        }), \"\\n\", _jsxs(_components.span, {\n          className: \"line\",\n          children: [_jsx(_components.span, {\n            style: {\n              color: \"#E5C07B\"\n            },\n            children: \"serverPluginApi\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \".\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#61AFEF\"\n            },\n            children: \"registerRemoteViewWebComponent\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \"(\"\n          })]\n        }), \"\\n\", _jsxs(_components.span, {\n          className: \"line\",\n          children: [_jsx(_components.span, {\n            style: {\n              color: \"#E06C75\"\n            },\n            children: \"  pluginName\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \",\"\n          })]\n        }), \"\\n\", _jsxs(_components.span, {\n          className: \"line\",\n          children: [_jsx(_components.span, {\n            style: {\n              color: \"#E06C75\"\n            },\n            children: \"  remoteWebComponentTag\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \",\"\n          })]\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"line\",\n          children: _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \");\"\n          })\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"line\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"line\",\n          children: _jsx(_components.span, {\n            style: {\n              color: \"#7F848E\",\n              fontStyle: \"italic\"\n            },\n            children: \"// Example of how the new API might look like\"\n          })\n        }), \"\\n\", _jsxs(_components.span, {\n          className: \"line\",\n          children: [_jsx(_components.span, {\n            style: {\n              color: \"#E5C07B\"\n            },\n            children: \"serverPluginApi\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \".\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#61AFEF\"\n            },\n            children: \"registerSceneState\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \"(\"\n          })]\n        }), \"\\n\", _jsxs(_components.span, {\n          className: \"line\",\n          children: [_jsx(_components.span, {\n            style: {\n              color: \"#E06C75\"\n            },\n            children: \"  pluginName\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \",\"\n          })]\n        }), \"\\n\", _jsxs(_components.span, {\n          className: \"line\",\n          children: [_jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \"  (\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#E06C75\",\n              fontStyle: \"italic\"\n            },\n            children: \"_\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \", \"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#E06C75\",\n              fontStyle: \"italic\"\n            },\n            children: \"rendererData\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \") \"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#C678DD\"\n            },\n            children: \"=\u003e\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \" {\"\n          })]\n        }), \"\\n\", _jsxs(_components.span, {\n          className: \"line\",\n          children: [_jsx(_components.span, {\n            style: {\n              color: \"#C678DD\"\n            },\n            children: \"    return\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \" {\"\n          })]\n        }), \"\\n\", _jsxs(_components.span, {\n          className: \"line\",\n          children: [_jsx(_components.span, {\n            style: {\n              color: \"#E06C75\"\n            },\n            children: \"      audioIsPlaying\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \": \"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#56B6C2\"\n            },\n            children: \"!!\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#E5C07B\"\n            },\n            children: \"rendererData\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \".\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#61AFEF\"\n            },\n            children: \"find\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \"((\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#E06C75\",\n              fontStyle: \"italic\"\n            },\n            children: \"x\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \") \"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#C678DD\"\n            },\n            children: \"=\u003e\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#E5C07B\"\n            },\n            children: \" x\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \".\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#E06C75\"\n            },\n            children: \"isPlaying\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \"),\"\n          })]\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"line\",\n          children: _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \"    }\"\n          })\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"line\",\n          children: _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \"  },\"\n          })\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"line\",\n          children: _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \");\"\n          })\n        })]\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Server handling\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Notice that the code above is handled on the server. This is because TheOpenPresenter consists of 3 separate components:\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"The Remote - where this audio indication is shown\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"The Renderer - plays the audio\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"The Server - connects the two\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Ideally, we should handle this in the frontend (remote) so that we don‚Äôt add extra load to the server. However, registering this function can be messy. Our frontend uses a micro-frontend architecture loaded with Web components.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The red area below is a React shell. The green area is loaded through web components and is managed by each plugin.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"/assets/blog/dont-fall-in-love-with-your-code/shell.png\",\n        alt: \"Shell\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Notice that the audio icon is located on the left side of the shell. How do we provide the function that we need to the shell? We could include a JS function in the web component bundle but that sounds like a mess in the long term.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Handling this on the server seems like the proper way to do this.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Plumbing the data through\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"With that decided, it‚Äôs time for implementation. There are a few things to do:\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Create the plugin API\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Provide this data to the frontend\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Consume and update the UI\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Implementing\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"I won‚Äôt bore you with the details so here‚Äôs an overview. The API was not quite straightforward since our data can be quite confusing. In short: A scene can have multiple plugins. And there can be multiple renderers, each viewing a scene in a different way. So a plugin could have multiple renderers showing it in different ways. But with a bit of data manipulation, problem solved.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.strong, {\n        children: \"Consuming and updating the UI\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Consuming the value was straightforward. I contemplated using Yjs‚Äôs awareness protocol to provide the data since it‚Äôs real-time and the framework is already in place. This is how the state is stored. However, including this data from the server is its own problem. So I decided to use GraphQL instead - the protocol we‚Äôre using for everything else in the platform.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"So all we need to do is call the endpoint, listen to it using GraphQL‚Äôs subscription, and show the icon as needed. Done.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.strong, {\n        children: \"Providing this data to the frontend\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Thankfully, we use \", _jsx(_components.a, {\n        href: \"https://postgraphile.org/\",\n        children: \"Postgraphile\"\n      }), \" which makes extending the GraphQL schema quite straightforward. We can also make it a subscription simply by adding  \", _jsx(_components.code, {\n        children: \"@pgSubscription\"\n      }), \" to the GraphQL schema. It‚Äôll then watch a topic and update the value whenever we call \", _jsx(_components.code, {\n        children: \"pg_notify\"\n      }), \" on that topic. For example:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"shiki one-dark-pro\",\n      style: {\n        backgroundColor: \"#282c34\",\n        color: \"#abb2bf\"\n      },\n      tabIndex: \"0\",\n      children: _jsxs(_components.code, {\n        children: [_jsxs(_components.span, {\n          className: \"line\",\n          children: [_jsx(_components.span, {\n            style: {\n              color: \"#C678DD\"\n            },\n            children: \"await\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#E5C07B\"\n            },\n            children: \" pgPool\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \".\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#61AFEF\"\n            },\n            children: \"query\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \"(\"\n          })]\n        }), \"\\n\", _jsxs(_components.span, {\n          className: \"line\",\n          children: [_jsx(_components.span, {\n            style: {\n              color: \"#98C379\"\n            },\n            children: \"  `select pg_notify('graphql:sceneState:\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#C678DD\"\n            },\n            children: \"${\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#E06C75\"\n            },\n            children: \"id\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#C678DD\"\n            },\n            children: \"}\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#98C379\"\n            },\n            children: \"','{}');`\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \",\"\n          })]\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"line\",\n          children: _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \"  [],\"\n          })\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"line\",\n          children: _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \");\"\n          })\n        })]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Manipulating the data was annoying but just a bit of patience and it‚Äôs done!\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The last piece of the puzzle is calling \", _jsx(_components.code, {\n        children: \"pg_notify\"\n      }), \" when we need to.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"For this, we can add a listener to the state (Yjs) and call the notify whenever anything changes:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"shiki one-dark-pro\",\n      style: {\n        backgroundColor: \"#282c34\",\n        color: \"#abb2bf\"\n      },\n      tabIndex: \"0\",\n      children: _jsxs(_components.code, {\n        children: [_jsxs(_components.span, {\n          className: \"line\",\n          children: [_jsx(_components.span, {\n            style: {\n              color: \"#E5C07B\"\n            },\n            children: \"state\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \".\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#61AFEF\"\n            },\n            children: \"observeDeep\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \"(\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#C678DD\"\n            },\n            children: \"async\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \" () \"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#C678DD\"\n            },\n            children: \"=\u003e\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \" {\"\n          })]\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"line\",\n          children: _jsx(_components.span, {\n            style: {\n              color: \"#7F848E\",\n              fontStyle: \"italic\"\n            },\n            children: \"  // Call pg_notify here\"\n          })\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"line\",\n          children: _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \"});\"\n          })\n        })]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The only thing left to do is performance improvements. Right now, the function is called for every small change, it‚Äôs also updated to the frontend. We can calculate the resulting state and compare if anything changes before pushing the update.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Better solution\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Now this solution certainly works. But I hated that we were listening to every single change. It‚Äôs unnecessary and I‚Äôm not sure how the performance will scale. Is there any better solution?\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"So I stepped back for a second and an idea came: \", _jsx(_components.strong, {\n        children: \"How about we go to the basics and use the data from Yjs?\"\n      })]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The problem was that each plugin may use different ways to indicate play status. So we needed a way to know how to calculate the resulting state ourselves. But rather than letting the user pass a function, \", _jsx(_components.strong, {\n        children: \"why not reserve a property that they can use to indicate this?\"\n      })]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Rather than passing a function to calculate the state, each plugin could set the reserved state directly alongside their existing data with properties like \", _jsx(_components.code, {\n        children: \"__audioIsPlaying\"\n      }), \" . They could use this value directly, or they could keep it in sync with their existing properties like so:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"shiki one-dark-pro\",\n      style: {\n        backgroundColor: \"#282c34\",\n        color: \"#abb2bf\"\n      },\n      tabIndex: \"0\",\n      children: _jsxs(_components.code, {\n        children: [_jsxs(_components.span, {\n          className: \"line\",\n          children: [_jsx(_components.span, {\n            style: {\n              color: \"#C678DD\"\n            },\n            children: \"const\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#61AFEF\"\n            },\n            children: \" onRendererDataLoaded\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#56B6C2\"\n            },\n            children: \" =\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \" (\"\n          })]\n        }), \"\\n\", _jsxs(_components.span, {\n          className: \"line\",\n          children: [_jsx(_components.span, {\n            style: {\n              color: \"#E06C75\",\n              fontStyle: \"italic\"\n            },\n            children: \"  rendererData\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \",\"\n          })]\n        }), \"\\n\", _jsxs(_components.span, {\n          className: \"line\",\n          children: [_jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \") \"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#C678DD\"\n            },\n            children: \"=\u003e\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \" {\"\n          })]\n        }), \"\\n\", _jsxs(_components.span, {\n          className: \"line\",\n          children: [_jsx(_components.span, {\n            style: {\n              color: \"#61AFEF\"\n            },\n            children: \"  watchYjs\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \"(\"\n          })]\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"line\",\n          children: _jsx(_components.span, {\n            style: {\n              color: \"#7F848E\",\n              fontStyle: \"italic\"\n            },\n            children: \"\\t  // Watch the isPlaying property\"\n          })\n        }), \"\\n\", _jsxs(_components.span, {\n          className: \"line\",\n          children: [_jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \"    (\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#E06C75\",\n              fontStyle: \"italic\"\n            },\n            children: \"x\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \") \"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#C678DD\"\n            },\n            children: \"=\u003e\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#E5C07B\"\n            },\n            children: \" x\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \".\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#E06C75\"\n            },\n            children: \"isPlaying\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \",\"\n          })]\n        }), \"\\n\", _jsxs(_components.span, {\n          className: \"line\",\n          children: [_jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \"    () \"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#C678DD\"\n            },\n            children: \"=\u003e\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \" {\"\n          })]\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"line\",\n          children: _jsx(_components.span, {\n            style: {\n              color: \"#7F848E\",\n              fontStyle: \"italic\"\n            },\n            children: \"\\t    // And if it changes, sync the __audioIsPlaying property\"\n          })\n        }), \"\\n\", _jsxs(_components.span, {\n          className: \"line\",\n          children: [_jsx(_components.span, {\n            style: {\n              color: \"#E5C07B\"\n            },\n            children: \"      rendererData\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \".\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#61AFEF\"\n            },\n            children: \"set\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \"(\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#98C379\"\n            },\n            children: \"\\\"__audioIsPlaying\\\"\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \", \"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#E5C07B\"\n            },\n            children: \"rendererData\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \".\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#61AFEF\"\n            },\n            children: \"get\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \"(\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#98C379\"\n            },\n            children: \"\\\"isPlaying\\\"\"\n          }), _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \"));\"\n          })]\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"line\",\n          children: _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \"    },\"\n          })\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"line\",\n          children: _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \"  );\"\n          })\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"line\",\n          children: _jsx(_components.span, {\n            style: {\n              color: \"#ABB2BF\"\n            },\n            children: \"};\"\n          })\n        })]\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Deleting old code\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The new method is brilliant. No extra listener, no extra API, just a simple reserved property.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The cost? Well, I already wrote 95% of the first implementation ü´£\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsxs(_components.em, {\n        children: [_jsx(_components.strong, {\n          children: \"‚ÄúIt‚Äôll be such a shame to delete this when I‚Äôve worked on it for so long. Everything else is perfect other than this one thing!‚Äù\"\n        }), \" - My mind\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"This is not my first time. Not second or third either. This time it was just a few hours of work. The longer it takes to implement, the harder it is to let go. But if we should not get attached to servers, we shouldn‚Äôt be attached to the code we write either.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"It‚Äôs obvious that the second implementation is better. It‚Äôs faster, less moving parts, less API surface, and less code to maintain. The \", _jsx(_components.a, {\n        href: \"https://github.com/Vija02/TheOpenPresenter/commit/485fd2ff4d4dc1fdb1e010da2fe71d9bdc7ca45f\",\n        children: \"first implementation\"\n      }), \" added 289 new lines while the \", _jsx(_components.a, {\n        href: \"https://github.com/Vija02/TheOpenPresenter/commit/8c72633158debf9dcb54e826e61cb69b31a304e7\",\n        children: \"second implementation\"\n      }), \" only added 32 new lines.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.strong, {\n        children: \"What‚Äôs the lesson to learn then?\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Well, maybe find the simplest solution first. But sometimes we don‚Äôt reach the best solution just by thinking about it. If that‚Äôs the case, \", _jsx(_components.strong, {\n        children: \"don‚Äôt love your code and don‚Äôt be afraid to throw it away\"\n      }), \". And maybe write a blog post so that you get something out of it!\"]\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsxs(_components.p, {\n      children: [\"If you're read this far, you might want to try \", _jsx(_components.a, {\n        href: \"https://theopenpresenter.com/\",\n        children: \"TheOpenPresenter\"\n      }), \"! It's an open-source presentation system that lets you control any of your screens remotely.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Show slideshows, play videos, use as dashboards and many more. The software is still very early in development as you can tell from this post but it's stable enough to use regularly. I personally use it for my meetups every week.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Any questions, do ask. Or feel free to report issues in the \", _jsx(_components.a, {\n        href: \"https://github.com/Vija02/TheOpenPresenter\",\n        children: \"Github repo\"\n      }), \".\"]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = {\n    ..._provideComponents(),\n    ...props.components\n  };\n  return MDXLayout ? _jsx(MDXLayout, {\n    ...props,\n    children: _jsx(_createMdxContent, {\n      ...props\n    })\n  }) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"dont-fall-in-love-with-your-code"},"buildId":"PAMaeYGHoosTgdPdoCx0F","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>